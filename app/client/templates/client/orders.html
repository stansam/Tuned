{% extends "client/base.html" %}

{% block title %}My Orders{% endblock %}

{% block styles %}
{{ super()}}
{% assets "client_client_orders_css" %}
    <link rel="stylesheet" href="{{ ASSET_URL }}">
{% endassets %}

{% endblock %}

{% block scripts %}
{{ super()}}
    {% assets "client_client_orders_js" %}
    <script type="text/javascript" src="{{ ASSET_URL }}"></script>
    {% endassets %}
{% endblock %}

{% block content %}
<div class="orders-header">
    <h1 class="orders-title">My Orders</h1>
    <div style="display: flex; align-items: center;">
        <a href="{{ url_for('client.new_order') }}" class="new-order-btn">
            New Order
        </a>
        <button class="refresh-btn" onclick="refreshOrders()"><i class="fas fa-sync-alt"></i> </button>
    </div>
</div>

<div class="filter-tabs">
    <a href="?status=active" class="filter-tab {{ 'active' if current_status == 'active' else '' }}">Active</a>
    <a href="?status=pending" class="filter-tab {{ 'active' if current_status == 'pending' else '' }}">Pending</a>
    <a href="?status=completed" class="filter-tab {{ 'active' if current_status == 'completed' else '' }}">Completed</a>
    <a href="?status=overdue" class="filter-tab {{ 'active' if current_status == 'overdue' else '' }}">Overdue</a>
</div>

<div class="controls-row">
    <div class="sort-control">
        <label for="sort-select">Sort by:</label>
        <select id="sort-select" class="sort-select" onchange="updateSort(this.value)">
            <option value="date" {{ 'selected' if sort_by == 'date' else '' }}>Date</option>
            <option value="title" {{ 'selected' if sort_by == 'title' else '' }}>Title</option>
            <option value="deadline" {{ 'selected' if sort_by == 'deadline' else '' }}>Deadline</option>
            <option value="price" {{ 'selected' if sort_by == 'price' else '' }}>Price</option>
        </select>
    </div>
    <div class="search-control">
        <input type="text" class="search-input" placeholder="Search order" value="{{ search_query or '' }}" onkeyup="handleSearch(event)">
        <span class="search-icon"><i class="fas fa-search"></i></span>
    </div>
</div>

<div class="orders-list">
    {% for order in orders.items %}
    <div class="order-card">
        <div class="order-info">
            <div class="order-indicator {{ order.status.replace(' ', '-') }}"></div>
            <div class="order-details">
                <a href="{{url_for('client.order_details', order_id=order.id)}}" class="order-title">{{ order.title or 'Order Titles xxx xxxx.444444444..' }}</a>
                <div class="order-meta">
                    <span class="order-number">{{ order.order_number or 'ORD-795-IAB71' }}</span>
                    <span class="order-pages">{{ order.pages or '20' }} Pages</span>
                    <span class="order-type">{{ order.order_type or 'Research Paper' }}</span>
                    <span class="order-status status-{{ order.status.replace(' ', '-') }}">
                        {% if order.status == 'in_progress' %}
                            In Progress
                        {% else %}
                            {{ order.status.title() }}
                        {% endif %}
                    </span>
                </div>
            </div>
        </div>
        <div class="order-actions">
            <button class="more-actions" onclick="showOrderActions('{{ order.id }}')"></button>
        </div>
    </div>
    {% else %}
    <!-- Sample orders for demonstration when no orders exist -->
    <div class="order-card">
        <div class="order-info">
            <div class="order-indicator pending"></div>
            <div class="order-details">
                <div class="order-title">Order Titles xxx xxxx.444444444..</div>
                <div class="order-meta">
                    <span class="order-number">ORD-795-IAB71</span>
                    <span class="order-pages">20 Pages</span>
                    <span class="order-type">Research Paper</span>
                    <span class="order-status status-pending">Pending</span>
                </div>
            </div>
        </div>
        <div class="order-actions">
            <button class="more-actions"></button>
        </div>
    </div>

    <div class="order-card">
        <div class="order-info">
            <div class="order-indicator in-progress"></div>
            <div class="order-details">
                <div class="order-title">Order Titles xxx xxxx.444444444..</div>
                <div class="order-meta">
                    <span class="order-number">ORD-795-IAB71</span>
                    <span class="order-pages">20 Pages</span>
                    <span class="order-type">Research Paper</span>
                    <span class="order-status status-in-progress">In Progress</span>
                </div>
            </div>
        </div>
        <div class="order-actions">
            <button class="more-actions"></button>
        </div>
    </div>

    <div class="order-card">
        <div class="order-info">
            <div class="order-indicator completed"></div>
            <div class="order-details">
                <div class="order-title">Order Titles xxx xxxx.444444444..</div>
                <div class="order-meta">
                    <span class="order-number">ORD-795-IAB71</span>
                    <span class="order-pages">20 Pages</span>
                    <span class="order-type">Research Paper</span>
                    <span class="order-status status-completed">Completed</span>
                </div>
            </div>
        </div>
        <div class="order-actions">
            <button class="more-actions"></button>
        </div>
    </div>

    <div class="order-card">
        <div class="order-info">
            <div class="order-indicator overdue"></div>
            <div class="order-details">
                <div class="order-title">Order Titles xxx xxxx.444444444..</div>
                <div class="order-meta">
                    <span class="order-number">ORD-795-IAB71</span>
                    <span class="order-pages">20 Pages</span>
                    <span class="order-type">Research Paper</span>
                    <span class="order-status status-overdue">Overdue</span>
                </div>
            </div>
        </div>
        <div class="order-actions">
            <button class="more-actions"></button>
        </div>
    </div>
    {% endfor %}
</div>

<!-- Pagination -->
{% if orders and orders.pages > 1 %}
<div class="pagination">
    {% if orders.has_prev %}
        <a href="{#{{ url_for('client.list_orders', page=orders.prev_num, status=current_status, sort_by=sort_by, search=search_query) }}#}">Previous</a>
    {% endif %}
    
    {% for page_num in orders.iter_pages() %}
        {% if page_num %}
            {% if page_num != orders.page %}
                <a href="{#{{ url_for('client.list_orders', page=page_num, status=current_status, sort_by=sort_by, search=search_query) }}#}">{{ page_num }}</a>
            {% else %}
                <strong>{{ page_num }}</strong>
            {% endif %}
        {% else %}
            <span>â€¦</span>
        {% endif %}
    {% endfor %}
    
    {% if orders.has_next %}
        <a href="{#{{ url_for('client.list_orders', page=orders.next_num, status=current_status, sort_by=sort_by, search=search_query) }}#}">Next</a>
    {% endif %}
</div>
{% endif %}
{% endblock %}

