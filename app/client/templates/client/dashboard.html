{% extends "client/base.html" %}
{% block title %}Dashboard {% endblock %}
{% block styles %}
{{ super()}}
{% assets "client_client_dashboard_css" %}
    <link rel="stylesheet" href="{{ ASSET_URL }}">
{% endassets %}
{% endblock %}

{% block scripts %}
{{ super() }}
{% assets "client_client_dashboard_js" %}
    <script type="text/javascript" src="{{ ASSET_URL }}"></script>
{% endassets %}
{% endblock %}

{% block content %}
<div class="dashboard-container">
    <!-- Profile Section -->
    <div class="profile-section">
        <div class="profile-header">
            <div class="profile-title-section">
                <h1 class="profile-title">My Profile</h1>
                <p class="profile-welcome">Welcome back, {{ current_user.first_name }} {{ current_user.last_name }}!</p>
                <p class="profile-subtitle">Here's what's happening with your account today</p>
            </div>
            <div class="profile-actions">
                <button type="button" class="edit-button" onclick="openProfileModal()"><div class="pen-icon"><i class="fas fa-edit"></i></div>Edit Profile</button>
                <button type="button" class="sync-button" onclick="refreshDashboard()"><i class="fas fa-sync-alt"></i></button>
            </div>
        </div>

        <div class="date-info">
            <div class="date-bullet"></div>
            <span>{{ current_time.strftime('%B %d, %Y') }}</span>
        </div>

        <div class="profile-content">
            <div class="dashboard-profile-avatar">
                <img src="{% if current_user.profile_pic and current_user.profile_pic != 'default.png' %}{{ current_user.get_profile_pic_url() }} {% else %} {{url_for('client.static', filename='client/assets/profile_pics/default.png')}} {% endif %} " 
                         alt="Profile Picture" 
                         class="dash-profile-pic">
            </div>

            <div class="profile-details">
                <div class="profile-info">
                    <div class="profile-info-label">Username:</div>
                    <div class="profile-info-value">{{ current_user.username or 'YatchChie' }}</div>
                </div>
                
                <div class="profile-info">
                    <div class="profile-info-label">Account Type:</div>
                    <div class="profile-info-value">{{ 'TunedOps' if current_user.is_admin else 'Patron' }}</div>
                </div>
                
                <div class="profile-info">
                    <div class="profile-info-label">Member Since:</div>
                    <div class="profile-info-value">{{ current_user.created_at.strftime('%b %Y') if current_user.created_at else 'June 2025' }}</div>
                </div>

                <div class="profile-badges">
                    <span class="badge badge-active">Active</span>
                </div>
            </div>

            <div class="stats-section">
                <div class="stat-item">
                    <div class="stat-number">{{ total_orders }}</div>
                    <div class="stat-label">
                        Orders
                        <div class="info-icon" title="Total Number of orders">i</div>
                        <!-- <div class="info-text"></div> -->
                    </div>
                </div>

                <div class="stat-item">
                    <div class="stat-number">${{ "%.0f"|format(total_spent) }}</div>
                    <div class="stat-label">
                        Spent
                        <div class="info-icon" title="Total Amount Spent">i</div>
                    </div>
                </div>

                <div class="stat-item">
                    <div class="stat-number">{{ reward_points }}</div>
                    <div class="stat-label">
                        Rewards
                        <div class="info-icon" title="Total Reward Points earned">i</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Order History Section -->
    <div class="order-history">
        <h2 class="order-history-title">Order History</h2>
        
        <table class="order-table">
            <thead>
                <tr>
                    <th>Order</th>
                    <th>Date</th>
                    <th>Status</th>
                    <th>Cost</th>
                    <th>Review</th>
                </tr>
            </thead>
            <tbody>
                {% for order in recent_orders %}
                <tr>
                    <td>{{ order.order_number or order.id }}</td>
                    <td>
                        {% set time_diff = (current_time - order.created_at).total_seconds() %}
                        {% if time_diff < 3600 %}
                            {{ "%.0f"|format(time_diff / 60) }} minutes ago
                        {% elif time_diff < 86400 %}
                            {{ "%.0f"|format(time_diff / 3600) }} hours ago
                        {% else %}
                            {{ order.created_at.strftime('%b %d, %Y, %I:%M %p') }}
                        {% endif %}
                    </td>
                    <td>
                        <span class="status-badge status-{{ order.status }}">
                            {{ order.status.title() }}
                        </span>
                    </td>
                    <td class="price">${{ "%.0f"|format(order.total_price or 0) }}</td>
                    <td>
                        {% if order.status == 'completed' %}
                        <div class="rating">
                            <span class="star">★</span>
                            <span class="star">★</span>
                            <span class="star">★</span>
                            <span class="star">★</span>
                            <span class="star">★</span>
                        </div>
                        {% else %}
                        <div class="rating">
                            <span class="star star-empty">☆</span>
                            <span class="star star-empty">☆</span>
                            <span class="star star-empty">☆</span>
                            <span class="star star-empty">☆</span>
                            <span class="star star-empty">☆</span>
                        </div>
                        {% endif %}
                    </td>
                </tr>
                {% else %}
                <tr>
                    <td colspan="5" style="text-align: center; padding: 40px; color: #666;">
                        No orders found
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

{% include 'client/profile/edit-profile.html' %}
{% endblock %}
